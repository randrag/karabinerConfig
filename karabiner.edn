{
 ;; Goku configuration for Karabiner-Elements
 ;; Run `goku` to compile this to ~/.config/karabiner/karabiner.json

 :profiles {:Goku {:default true
                   :sim 50           ;; simultaneous threshold (default 50)
                   :alone 500        ;; to_if_alone_timeout (default 1000)
                   :delay 500        ;; delayed action delay (default 500)
                   :held 500         ;; held down threshold (default 500)
                   :simlayer-threshold 250}}

 ;; Application identifiers for conditions
 :applications {
   :Parallels ["^com\\.parallels\\.desktop\\.console$"]
   :Rider ["^com\\.jetbrains\\.rider$"]
   :Jump ["^com\\.p5sys\\.jump\\.mac\\.viewer$"]
   :JumpOrParallels ["^com\\.p5sys\\.jump\\.mac\\.viewer$"
                     "^com\\.parallels\\.desktop\\.console$"]
 }

 ;; Templates for shell commands
 :templates {
   :open "open \"%s\""
   :osascript "osascript \"%s\""
 }

 ;; Modifier key reference:
 ;; From side: C=left_cmd, T=left_ctrl, O=left_opt, S=left_shift
 ;;            Q=right_cmd, W=right_ctrl, E=right_opt, R=right_shift
 ;; ! = mandatory, # = optional, ## = optional any
 ;; Hyper = !QWER (all right modifiers)

 :main [
   ;; ============================================================
   ;; Caps lock to hyper (except Parallels)
   ;; ============================================================
   {:des "Caps lock to hyper"
    :rules [[:##caps_lock {:key :right_shift
                           :modi [:right_command :right_control :right_option]}
             [:!Parallels]]]}

   ;; ============================================================
   ;; Hyper + t launches Things 3 (t is on qwerty f)
   ;; ============================================================
   {:des "Hyper + t launches Things 3"
    :rules [[:!QWERf [:open "/Applications/Things3.app"]]]}

   ;; ============================================================
   ;; Hyper + w launches WhatsApp
   ;; ============================================================
   {:des "Hyper + w launches WhatsApp"
    :rules [[:!QWERw [:open "/Applications/WhatsApp.app"]]]}

   ;; ============================================================
   ;; Hyper + r launches Rider (r is on qwerty s)
   ;; ============================================================
   {:des "Hyper + r launches Rider"
    :rules [[:!QWERs [:open "/Applications/Rider.app"]]]}

   ;; ============================================================
   ;; Hyper + f opens Finder in home folder (f is on qwerty e)
   ;; ============================================================
   {:des "Hyper + f opens Finder in home"
    :rules [[:!QWERe [:open "/Users/roland"]]]}

   ;; ============================================================
   ;; Hyper + d opens Downloads folder (d is on qwerty g)
   ;; ============================================================
   {:des "Hyper + d opens Downloads"
    :rules [[:!QWERg [:open "/Users/roland/Downloads"]]]}

   ;; ============================================================
   ;; Hyper + b launches Safari
   ;; ============================================================
   {:des "Hyper + b launches Safari"
    :rules [[:!QWERb [:open "/Applications/Safari.app"]]]}

   ;; ============================================================
   ;; Hyper + x opens StockManager in Safari
   ;; ============================================================
   {:des "Hyper + x opens StockManager"
    :rules [[:!QWERx [:osascript "/Users/roland/.config/karabiner/open-stockmanager.scpt"]]]}

   ;; ============================================================
   ;; Hyper + c opens work calendar in Safari
   ;; ============================================================
   {:des "Hyper + c opens work calendar"
    :rules [[:!QWERc [:osascript "/Users/roland/.config/karabiner/open-calendar-work.scpt"]]]}

   ;; ============================================================
   ;; Hyper + v opens D-Number in Safari
   ;; ============================================================
   {:des "Hyper + v opens D-Number"
    :rules [[:!QWERv [:osascript "/Users/roland/.config/karabiner/open-dnumber.scpt"]]]}

   ;; ============================================================
   ;; Hyper + g launches GitKraken (g is on qwerty t)
   ;; ============================================================
   {:des "Hyper + g launches GitKraken"
    :rules [[:!QWERt [:open "/Applications/GitKraken.app"]]]}

   ;; ============================================================
   ;; Hyper + j launches Jump Desktop (j is on qwerty y)
   ;; ============================================================
   {:des "Hyper + j launches Jump Desktop"
    :rules [[:!QWERy [:open "/Applications/Jump Desktop.app"]]]}

   ;; ============================================================
   ;; Hyper + p pastes current date (p is on qwerty r)
   ;; ============================================================
   {:des "Hyper + p pastes current date"
    :rules [[:!QWERr [:osascript "/Users/roland/.config/karabiner/paste-date.scpt"]]]}

   ;; ============================================================
   ;; Hyper + a opens Grok in Safari
   ;; ============================================================
   {:des "Hyper + a opens Grok"
    :rules [[:!QWERa [:osascript "/Users/roland/.config/karabiner/open-grok.scpt"]]]}

   ;; ============================================================
   ;; Hyper + space launches iTerm
   ;; ============================================================
   {:des "Hyper + space launches iTerm"
    :rules [[:!QWERspacebar [:open "/Applications/iTerm.app"]]]}

   ;; ============================================================
   ;; Hyper + ` launches Commander One
   ;; ============================================================
   {:des "Hyper + ` launches Commander One"
    :rules [[:!QWERgrave_accent_and_tilde [:open "/Applications/Commander One.app"]]]}

   ;; ============================================================
   ;; Hyper + 1 launches 1Password
   ;; ============================================================
   {:des "Hyper + 1 launches 1Password"
    :rules [[:!QWER1 [:open "/Applications/1Password.app"]]]}

   ;; ============================================================
   ;; Hyper + 2 opens Google Chat in Safari
   ;; ============================================================
   {:des "Hyper + 2 opens Google Chat"
    :rules [[:!QWER2 [:osascript "/Users/roland/.config/karabiner/open-google-chat.scpt"]]]}

   ;; ============================================================
   ;; Hyper + 3 opens work Gmail in Safari
   ;; ============================================================
   {:des "Hyper + 3 opens work Gmail"
    :rules [[:!QWER3 [:osascript "/Users/roland/.config/karabiner/open-gmail-work.scpt"]]]}

   ;; ============================================================
   ;; Hyper + 4 opens personal Gmail in Safari
   ;; ============================================================
   {:des "Hyper + 4 opens personal Gmail"
    :rules [[:!QWER4 [:osascript "/Users/roland/.config/karabiner/open-gmail-personal.scpt"]]]}

   ;; ============================================================
   ;; Hyper + 5 opens work Google Drive in Safari
   ;; ============================================================
   {:des "Hyper + 5 opens work Google Drive"
    :rules [[:!QWER5 [:osascript "/Users/roland/.config/karabiner/open-google-drive-work.scpt"]]]}

   ;; ============================================================
   ;; Hyper + 6 opens personal Google Drive in Safari
   ;; ============================================================
   {:des "Hyper + 6 opens personal Google Drive"
    :rules [[:!QWER6 [:osascript "/Users/roland/.config/karabiner/open-google-drive-personal.scpt"]]]}

   ;; ============================================================
   ;; Hyper + n/e/i/u for arrow keys (Colemak home row)
   ;; n=left, e=down, i=right, u=up
   ;; + Cmd for word skip (Option+arrow)
   ;; ============================================================
   {:des "Hyper + arrow keys (n/e/i/u)"
    :rules [
      ;; Basic arrows
      [:!QWERj :left_arrow]   ; Hyper+n (qwerty j) → left
      [:!QWERk :down_arrow]   ; Hyper+e (qwerty k) → down
      [:!QWERl :right_arrow]  ; Hyper+i (qwerty l) → right
      [:!QWERi :up_arrow]     ; Hyper+u (qwerty i) → up
      ;; Hyper + Option for selection (Shift+arrow)
      [:!QWEROj {:key :left_arrow :modi [:left_shift]}]     ; Hyper+Opt+n → Shift+left (select left)
      [:!QWEROk {:key :down_arrow :modi [:left_shift]}]     ; Hyper+Opt+e → Shift+down (select down)
      [:!QWEROl {:key :right_arrow :modi [:left_shift]}]    ; Hyper+Opt+i → Shift+right (select right)
      [:!QWEROi {:key :up_arrow :modi [:left_shift]}]       ; Hyper+Opt+u → Shift+up (select up)
      ;; Hyper + Cmd for word skip (left/right) and document start/end (up/down)
      [:!QWERCj {:key :left_arrow :modi [:left_option]}]    ; Hyper+Cmd+n → Option+left (word left)
      [:!QWERCl {:key :right_arrow :modi [:left_option]}]   ; Hyper+Cmd+i → Option+right (word right)
      [:!QWERCi {:key :up_arrow :modi [:left_command]}]     ; Hyper+Cmd+u → Cmd+up (doc start)
      [:!QWERCk {:key :down_arrow :modi [:left_command]}]   ; Hyper+Cmd+e → Cmd+down (doc end)
      ;; Hyper + Cmd + Option for selection with word/doc movement
      [:!QWERCOj {:key :left_arrow :modi [:left_option :left_shift]}]    ; Hyper+Cmd+Opt+n → Shift+Option+left (select word left)
      [:!QWERCOl {:key :right_arrow :modi [:left_option :left_shift]}]   ; Hyper+Cmd+Opt+i → Shift+Option+right (select word right)
      [:!QWERCOi {:key :up_arrow :modi [:left_command :left_shift]}]     ; Hyper+Cmd+Opt+u → Shift+Cmd+up (select to doc start)
      [:!QWERCOk {:key :down_arrow :modi [:left_command :left_shift]}]   ; Hyper+Cmd+Opt+e → Shift+Cmd+down (select to doc end)
    ]}

   ;; ============================================================
   ;; Colemak layout (QWERTY → Colemak remapping)
   ;; ============================================================
   {:des "Colemak layout"
    :rules [
      ;; Top row
      [:##e :f]
      [:##r :p]
      [:##t :g]
      [:##y :j]
      [:##u :l]
      [:##i :u]
      [:##o :y]
      [:##p :semicolon]
      ;; Home row
      [:##s :r]
      [:##d :s]
      [:##f :t]
      [:##g :d]
      [:##j :n]
      [:##k :e]
      [:##l :i]
      [:##semicolon :o]
      ;; Bottom row
      [:##n :k]
    ]}

   ;; ============================================================
   ;; § to backspace unless Rider
   ;; ============================================================
   {:des "§ to backspace unless Rider"
    :rules [[:non_us_backslash :delete_or_backspace [:!Rider]]]}

   ;; ============================================================
   ;; Window arrangement keys
   ;; ============================================================
   {:des "F16 to hyper-[ for window arrangement"
    :rules [[:f16 {:key :open_bracket
                   :modi [:right_shift :right_command :right_control :right_option]}]]}

   {:des "F19 to hyper-] for window arrangement"
    :rules [[:f19 {:key :close_bracket
                   :modi [:right_shift :right_command :right_control :right_option]}]]}

   ;; ============================================================
   ;; SSMS on Jump to Rider mapping (Jump Desktop only)
   ;; ============================================================
   {:des "SSMS on Jump to Rider mapping"
    :rules [
      ;; right_control to right_command in Jump
      [:right_control :right_command [:Jump]]
      ;; alt+ctrl+shift+arrow to alt+arrow (move line in SSMS → Rider)
      [:!OTSup_arrow {:key :up_arrow :modi [:left_option]} [:Jump]]
      [:!OTSdown_arrow {:key :down_arrow :modi [:left_option]} [:Jump]]
      ;; ctrl+shift+arrow to alt+shift+arrow (select line in SSMS → Rider)
      [:!TSup_arrow {:key :up_arrow :modi [:left_option :left_shift]} [:Jump]]
      [:!TSdown_arrow {:key :down_arrow :modi [:left_option :left_shift]} [:Jump]]
    ]}

   ;; ============================================================
   ;; F# operators
   ;; ============================================================
   {:des "Cmd-shift > to F# forward pipe operator (|>)"
    :rules [[:!CSperiod [{:key :backslash :modi [:shift]}
                         {:key :period :modi [:shift]}]]]}

   {:des "Cmd-shift - to F# forward arrow operator (->)"
    :rules [[:!CShyphen [:hyphen {:key :period :modi [:shift]}]]]}

   ;; ============================================================
   ;; Auto-pair brackets with cursor positioning
   ;; ============================================================
   {:des "Cmd-shift-9 to () plus cursor movement"
    :rules [[:!CS9 [{:key :9 :modi [:shift]}
                    {:key :0 :modi [:shift]}
                    :left_arrow]]]}

   {:des "Cmd-shift-backslash to || plus cursor movement"
    :rules [[:!CSbackslash [{:key :backslash :modi [:shift]}
                            {:key :backslash :modi [:shift]}
                            :left_arrow]]]}

   {:des "Cmd-shift-comma (<) to <> plus cursor movement"
    :rules [[:!CScomma [{:key :comma :modi [:shift]}
                        {:key :period :modi [:shift]}
                        :left_arrow]]]}

   ;; ============================================================
   ;; Right control to option (Magic Keyboard word-skip fix)
   ;; ============================================================
   {:des "Right control to option to make magic keyboard same as mac when skipping words with cursor keys (except Jump desktop)"
    :rules [
      [:right_control :right_option [:!JumpOrParallels]]
      [:!Sright_control {:key :right_option :modi [:shift]} [:!Jump]]
    ]}

   ;; ============================================================
   ;; Home/End navigation (Mac-style line navigation)
   ;; ============================================================
   {:des "Home to Command-Left arrow to go to beginning of line (except Jump desktop)"
    :rules [[:home {:key :left_arrow :modi [:command]} [:!JumpOrParallels]]]}

   {:des "End to Command-Right arrow to go to end of line (except Jump desktop)"
    :rules [[:end {:key :right_arrow :modi [:command]} [:!JumpOrParallels]]]}

   {:des "Shift-Home to Shift-Command-Left Arrow to mark up to beginning of line (except Jump desktop)"
    :rules [[:!Shome {:key :left_arrow :modi [:command :left_shift]} [:!JumpOrParallels]]]}

   {:des "Shift-End to Shift-Command-Right Arrow to mark up to end of line (except Jump desktop)"
    :rules [[:!Send {:key :right_arrow :modi [:command :left_shift]} [:!JumpOrParallels]]]}

   ;; ============================================================
   ;; Simple modification equivalent (keypad enter)
   ;; ============================================================
   {:des "Keypad enter to return"
    :rules [[:keypad_enter :return_or_enter]]}
 ]

 ;; NOTE: The following settings are NOT generated by Goku and must be
 ;; configured manually in Karabiner-Elements or added to the output JSON:
 ;;
 ;; Devices:
 ;;   - Apple keyboard (vendor 76, product 620): manipulate_caps_lock_led: false
 ;;   - Logitech mouse (vendor 1133, product 45108): ignore: false, mouse_flip_horizontal_wheel: true
 ;;
 ;; Virtual HID Keyboard:
 ;;   - country_code: 0
 ;;   - keyboard_type_v2: "ansi"
 ;;
 ;; Global:
 ;;   - unsafe_ui: true
}
